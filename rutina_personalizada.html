<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2196F3">
  <meta name="description" content="Registro de Entrenamientos en FITABAPP">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="css/styles.css">

  <!-- Flatpickr CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<!-- Flatpickr JS -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script> <!-- Librería de español -->

  <title>Rutina Personalizada - FITABAPP</title>

  <style>
    .form-section {
      margin-top: 20px;
    }
    .app-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;

      background-color: #2196F3;
      color: white;
    }
    .nav-icons {
      cursor: pointer;
    }
    .date-selector {
      display: flex;
      align-items: center;
      justify-content: center;

    }
    .date-selector i{
    color: white;
      background-color: #2196F3;
      padding: 5px;
      border-radius: 5px;
    }
    .contenedor_rutina_hoy {
      margin-top: 80px;
      margin-bottom: 60px;
    }
    .time-input-group {
      display: flex;
      align-items: center;
    }
    .time-input-group input {
      width: 45%;
    }
    .time-input-group span {
      width: 10%;
      text-align: center;
    }


    td, tr {
  text-align: center;
}

th{
  font-weight: 600;
}


#save-button{
  background-color: #2196F3;
}

.card-header{
  color: white;
}

th{
  font-weight: 500;
  color: rgb(136, 134, 134);
}

tr{
vertical-align: middle;
}



/* parael flat picker*/

.flatpickr-calendar{
  box-shadow: 0px 0 0 #e6e6e6 !important;
}

.flatpickr-month{
  background-color: #2196F3 !important; /* Color oscuro típico de App Bar */
color: white !important;
border-top-left-radius: 5px;
border-top-right-radius: 5px;
}

svg {
  vertical-align: top !important;
  
}

.today{
  border-color: #2196F3 !important;
  color: #2196F3 !important;
}

.selected{
  background-color: #2196F3 !important; /* Color oscuro típico de App Bar */
  color: white !important;
}

.flatpickr-monthDropdown-month{
  background-color: #fff !important;
  color: #818181 !important;
}

.numInputWrapper span {
  opacity: 1 !important;
}
  </style>

</head>
<body>
  <!-- App Bar -->
  <div class="app-bar">
    <div class="nav-icons" id="back-button">
      <i class="bi bi-arrow-left"></i> <!-- Botón de atrás -->
    </div>
    <h1>Rutina Hoy</h1>
    <div class="d-flex">
      <i id="calendar-icon" class="bi bi-calendar me-3"></i> <!-- Icono de calendario -->
      <i class="bi bi-three-dots-vertical" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false"></i>
      <!-- Menú desplegable -->
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
        <li class="d-flex align-items-center">
          <i class="bi bi-bar-chart-line-fill ms-3" style="font-size: 14px;"></i>
          <a class="dropdown-item" href="recuento_cargas.html" id="estadisticas">Recuento</a>
        </li>
        <li class="d-flex align-items-center">
          <i class="bi bi-calculator-fill ms-3" style="font-size: 14px;"></i>
          <a class="dropdown-item" href="calculadora1rm.html" id="calculadora1rm">Calculadora 1RM</a>
        </li>

        </ul>
    </div>
  </div>

  <div class="container-fluid contenedor_rutina_hoy">
    <div class="col-12 text-center p-0" id="hoy">
      Fecha:
    </div>
    <!-- Selector de fecha -->
    <div class="date-selector">
      <i id="prev-day" class="bi bi-chevron-left"></i>
      <input type="text" id="date-input" class="form-control text-center mx-2" value="" readonly>
      <i id="next-day" class="bi bi-chevron-right"></i>
    </div>
    
    <div id="rutina-container" class="mt-4"></div>

  </div>

  <script>
    // Función para cargar las rutinas desde el JSON
    async function cargarRutinas() {
      const response = await fetch('json/rutinas_custom.json');
      const data = await response.json();
      return data.rutinas;
    }
  
    // Función para mostrar la rutina
    function mostrarRutina(rutina) {
      const container = document.getElementById('rutina-container');
      container.innerHTML = `
        <div class="card">
          <img src="${rutina.url_imagen}" class="card-img-top" alt="${rutina.nombre}">
          <div class="card-body">
            <h5 class="card-title">${rutina.nombre}</h5>
            <p class="card-text">${rutina.descripcion}</p>
            <h6>Ejercicios:</h6>
            <ul>
              ${rutina.ejercicios.map(ejercicio => `
                <li>
                  ${ejercicio.cantidad} ${ejercicio.medicion} de ${ejercicio.series} series
                </li>
              `).join('')}
            </ul>
          </div>
        </div>
      `;
    }
  
    // Función para buscar y mostrar la rutina correspondiente
    async function buscarRutina() {
      const idUsuario = localStorage.getItem('username'); // Obtener el ID del usuario
      const fechaSeleccionada = document.getElementById('date-input').value; // Obtener la fecha seleccionada
  
      const rutinas = await cargarRutinas(); // Cargar rutinas desde el JSON
  
      // Buscar la rutina que coincida con el ID de usuario y la fecha seleccionada
      const rutinaEncontrada = rutinas.find(rutina => 
        rutina.username == idUsuario && rutina.fecha === fechaSeleccionada
      ); 
  
      // Mostrar la rutina si se encontró
      if (rutinaEncontrada) {
        mostrarRutina(rutinaEncontrada);
      } else {
        document.getElementById('rutina-container').innerHTML = `<p>No se encontraron rutinas para esta fecha.</p>`;
      }
    }
  
    // Agregar un listener al input de fecha para buscar la rutina al cambiar la fecha
    document.getElementById('date-input').addEventListener('change', buscarRutina);
  </script>




<!-- Modal para el Calendario -->
<div class="modal fade" id="calendarModal" tabindex="-1" aria-labelledby="calendarModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background-color: transparent;">
        <div class="modal-body" style="display: flex; justify-content: center; align-items: center; padding: 20px;">
          <div id="calendar"></div> <!-- Contenedor para el calendario -->
        </div>
      </div>
    </div>
  </div>




  
  
  <script>
    // Abrir el modal al hacer clic en el icono de calendario
document.getElementById('calendar-icon').addEventListener('click', function() {
  const calendarModal = new bootstrap.Modal(document.getElementById('calendarModal'));
  calendarModal.show();

  // Inicializar Flatpickr en el contenedor del modal
  flatpickr("#calendar", {
    locale: "es", // Establecer el idioma a español
    inline: true, // Mostrar el calendario dentro del modal
    dateFormat: "Y-m-d", // Formato de fecha
    onChange: function(selectedDates) {
      const selectedDate = selectedDates[0];
      if (selectedDate) {
        // Actualizar el input de fecha con la fecha seleccionada
        document.getElementById('date-input').value = selectedDate.toISOString().split('T')[0];
        calendarModal.hide(); // Cerrar el modal después de seleccionar la fecha

        mostrarHoySiEsHoy();
        buscarRutina();
      }
    }
  });
});

  </script>


  <script>

    // Navegar entre fechas
    document.getElementById('prev-day').addEventListener('click', () => cambiarFecha(-1));
    document.getElementById('next-day').addEventListener('click', () => cambiarFecha(1));

    // Volver a la pantalla anterior
    document.getElementById('back-button').addEventListener('click', function() {
      history.back();
    });


// Manejar la navegación entre fechas
const dateInput = document.getElementById('date-input');

// Función para cambiar la fecha en el formato deseado
function cambiarFecha(dias) {
  // Cambiar 'Hoy' por la fecha actual en formato YYYY-MM-DD
  const fechaActual = new Date(dateInput.value);
  fechaActual.setDate(fechaActual.getDate() + dias);

  // Actualizar el input con la nueva fecha en formato YYYY-MM-DD
  const nuevaFecha = fechaActual.toISOString().split('T')[0];
  dateInput.value = nuevaFecha;


  mostrarHoySiEsHoy();
  buscarRutina();
}


// Al cargar el documento
document.addEventListener('DOMContentLoaded', function() {
   // Establecer la fecha actual en formato YYYY-MM-DD
   const fechaActual = new Date();
  const offset = fechaActual.getTimezoneOffset(); // Obtener la diferencia en minutos
  fechaActual.setMinutes(fechaActual.getMinutes() - offset); // Ajustar la fecha

  const fechaFormateada = fechaActual.toISOString().split('T')[0]; // Obtener solo la parte de la fecha
  document.getElementById('date-input').value = fechaFormateada; // Asignar la fecha formateada al input
  mostrarHoySiEsHoy();
  buscarRutina();
});


  </script>

<script>
  // Función para mostrar el div "hoy" si la fecha seleccionada es la fecha actual
  function mostrarHoySiEsHoy() {
    const fechaInput = document.getElementById('date-input').value;
    
    // Solo ejecuta si hay una fecha seleccionada
    if (!fechaInput) {
      return; // No hacer nada si no hay una fecha
    }

    // Obtener la fecha actual en formato YYYY-MM-DD de la zona horaria local
    const hoy = new Date();
    const año = hoy.getFullYear();
    const mes = ("0" + (hoy.getMonth() + 1)).slice(-2); // Obtener el mes y asegurar dos dígitos
    const día = ("0" + hoy.getDate()).slice(-2); // Obtener el día y asegurar dos dígitos
    const fechaActual = `${año}-${mes}-${día}`; // Construir la fecha en formato YYYY-MM-DD

    // Calcular la fecha de mañana
    const mañana = new Date();
    mañana.setDate(mañana.getDate() + 1);
    const fechaMañana = `${mañana.getFullYear()}-${("0" + (mañana.getMonth() + 1)).slice(-2)}-${("0" + mañana.getDate()).slice(-2)}`;

    // Calcular la fecha de ayer
    const ayer = new Date();
    ayer.setDate(ayer.getDate() - 1);
    const fechaAyer = `${ayer.getFullYear()}-${("0" + (ayer.getMonth() + 1)).slice(-2)}-${("0" + ayer.getDate()).slice(-2)}`;

    // Comparar fecha seleccionada con la fecha actual, mañana y ayer
    if (fechaInput === fechaActual) {
      document.getElementById('hoy').innerText = "Hoy";
    } else if (fechaInput === fechaMañana) {
      document.getElementById('hoy').innerText = "Mañana";
    } else if (fechaInput === fechaAyer) {
      document.getElementById('hoy').innerText = "Ayer";
    } else {
      document.getElementById('hoy').innerText = "Fecha:";
    }
  }
</script>




  <!-- Bootstrap JS and dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
