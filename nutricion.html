<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2196F3">
  <meta name="description" content="FITABAPP">
  <link rel="icon" type="image/jpg" href="img/favicon.ico"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="manifest" href="manifest.json">
  <title>FITABAPP</title>
  
  <!-- Incluir el archivo auth.js -->
  <script src="js/auth.js"></script>
  <script>
    // Llamar a la función para verificar si el usuario está logueado
    window.addEventListener('load', checkLogin);
  </script>
</head>
<body>
  <!-- App Bar -->
  <div class="app-bar">
    <h1>Dieta del día</h1> <!-- Título dinámico -->
    <div class="nav-icons"></div>
  </div>

  <div class="container-fluid" id="container-nutricion">
    <div class="d-flex justify-content-between align-items-center my-3" id="selector-dias">
      <button id="prev-dia" class="btn btn-primary"><i class="bi bi-chevron-left"></i></button>
      <span id="dia-actual" class="fs-4"></span>
      <button id="next-dia" class="btn btn-primary"><i class="bi bi-chevron-right"></i></button>
      
    </div>

    <div id="dieta"></div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="navbar navbar-expand fixed-bottom navbar-light p-0" style="background-color: #2196F3;">
    <div class="container-fluid p-0 m-0">
      <ul class="navbar-nav w-100 d-flex justify-content-between">
        <li class="nav-item text-center">
            <a class="nav-link text-white" href="index.html">
                <i class="bi bi-house-fill"></i><br>
                Inicio
            </a>
        </li>
        <li class="nav-item text-center">
          <a class="nav-link text-white" href="rutinas.html">
              <i class="bi bi-clipboard2-minus-fill"></i><br>
              Rutinas
          </a>
      </li>
        <li class="nav-item text-center">
            <a class="nav-link text-white" href="ejercicios.html">
                <i class="bi bi-lightning-fill"></i><br>
                Ejercicios
            </a>
        </li>
        <li class="nav-item text-center">
            <a class="nav-link text-white active" href="nutricion.html">
                <i class="bi bi-apple"></i><br>
                Nutrición
            </a>
        </li>

    </ul>
    </div>
  </nav>

  <!-- Bootstrap JS and dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Array de los días de la semana
    const dias = ["domingo", "lunes", "martes", "miércoles", "jueves", "viernes", "sábado"];
    let diaActualIndice = new Date().getDay(); // Obtiene el índice del día actual (0=domingo, 6=sábado)
    
    // Función para actualizar el día mostrado
    function actualizarDia() {
      const diaActual = dias[diaActualIndice]; // Día en texto
      document.getElementById('dia-actual').textContent = diaActual.charAt(0).toUpperCase() + diaActual.slice(1);
      cargarDietaPorDia(diaActual); // Cargar la dieta del día seleccionado
    }

    // Cargar dietas y mostrar la dieta del día seleccionado
    async function cargarDietaPorDia(dia) {
        const usuario = localStorage.getItem('username'); // Obtener nombre de usuario

        try {
            const response = await fetch('json/dietas.json'); // Cargar el archivo JSON
            const dietas = await response.json(); // Convertir a objeto JSON

            // Buscar la dieta del usuario
            const dietaUsuario = dietas.find(dieta => dieta.usuario === usuario);

            if (dietaUsuario) {
                const comidasDelDia = dietaUsuario[dia]; // Obtener las comidas del día
                let contenido = ``; // No se mostrará ningún título

                for (const [comida, alimentos] of Object.entries(comidasDelDia)) {
    contenido += `
    <div class="card mb-3">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center" id="heading-${comida}">
            <h5 class="mb-0">
                ${comida.charAt(0).toUpperCase() + comida.slice(1)}
            </h5>
            <!-- Ícono de colapso flotante -->
            <button class="btn btn-link text-white p-0" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${comida}" aria-expanded="true" aria-controls="collapse-${comida}">
                <i class="bi bi-chevron-up"></i>
            </button>
        </div>
        <div id="collapse-${comida}" class="collapse show" aria-labelledby="heading-${comida}">
            <div class="card-body">
                <ul>`;
    alimentos.forEach(alimento => {
        contenido += `<li>${alimento.cantidad} ${alimento.unidad} de ${alimento.alimento}</li>`;
    });
    contenido += `</ul>
            </div>
        </div>
    </div>`;
}


                document.getElementById('dieta').innerHTML = contenido; // Mostrar en el contenedor
            } else {
                document.getElementById('dieta').innerHTML = "<p>No se encontró la dieta para el usuario.</p>";
            }
        } catch (error) {
            console.error('Error al cargar las dietas:', error);
            document.getElementById('dieta').innerHTML = "<p>Error al cargar las dietas.</p>";
        }
    }

    // Navegar al día anterior
    document.getElementById('prev-dia').addEventListener('click', () => {
      diaActualIndice = (diaActualIndice - 1 + dias.length) % dias.length; // Ciclar entre días
      actualizarDia();
    });

    // Navegar al día siguiente
    document.getElementById('next-dia').addEventListener('click', () => {
      diaActualIndice = (diaActualIndice + 1) % dias.length; // Ciclar entre días
      actualizarDia();
    });

    // Cargar el día actual al cargar la página
    window.onload = actualizarDia;
  </script>
</body>
</html>
